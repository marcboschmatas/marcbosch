{
  "hash": "2f9536aba73d3f5b132effee0250d008",
  "result": {
    "markdown": "---\ntitle: \"Evolució de la temperatura a l'observatori Fabra 2009-2023\"\nauthor: \"Marc Bosch\"\ndate: \"2023-02-08\"\ncategories: [R, ggplot2, clima, tufte]\nexecute:\n  warning: false\n  error: false\n  message: false\nformat:\n  html: \n    code-fold: true\n    code-summary: \"Show the code\"\n    fig-width: 15\n---\n\n\nEl meteocat ofereix en obert les dades de tots els observatoris meteorològics de Catalunya d'entre 2009 i avui, actualitzades en directe. Avui aprofito per presentar l'evolució de la temperatura de cada mes entre 2009 i 2022 a l'Observatori Fabra. De pas, aprofito per compartir una manera diferent de presentar els gràfics de caixa i bigotis segons les idees de l'estadístic i politòleg Edward Tufte. Però anem a pams, primer, baixem les dades del portal de la Generalitat i mirem quina pinta fan.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(httr)\nlibrary(jsonlite)\nlibrary(ggthemes)\nlibrary(palmerpenguins)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntemps <- GET(\"https://analisi.transparenciacatalunya.cat/resource/nzvn-apee.json?codi_variable=32&codi_estacio=D5&$limit=1000000\") |> \n  content(as = \"text\") |> \n  fromJSON()\nknitr::kable(head(temps[,2:5]))\n```\n\n::: {.cell-output-display}\n|codi_estacio |codi_variable |data_lectura            |valor_lectura |\n|:------------|:-------------|:-----------------------|:-------------|\n|D5           |32            |2009-01-01T00:00:00.000 |9.1           |\n|D5           |32            |2009-01-01T00:30:00.000 |9.6           |\n|D5           |32            |2009-01-01T01:00:00.000 |9.7           |\n|D5           |32            |2009-01-01T01:30:00.000 |9.9           |\n|D5           |32            |2009-01-01T02:00:00.000 |10            |\n|D5           |32            |2009-01-01T02:30:00.000 |10.2          |\n:::\n:::\n\n\nVeiem el codi de l'estació (Observatori Fabra), el codi de la variable (temperatura), la data i l'hora en què s'ha pres la mesura (un cop cada mitja hora) i el valor (és a dir, la temperatura registrada).\n\n\nI un cop les tenim, fem el gràfic. Per representar la informació he triat fer un gràfic de caixa i bigotis, que ens indica on són el mínim, el primer quartil, la mediana, el tercer quartil i el màxim. Els valors extrems (és a dir, molt més allunyats dels mínims i màxims), els representa com a punts per a mostrar que estan molt allunyats de la distribució més habitual dels gràfics. Normalment estem acostumats a que facin una pinta així.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntheme_set(ggthemes::theme_tufte(base_family = \"Roboto condensed\")) # triem el tema del gràfic\nggplot(penguins, aes(x = species, group = species, y = bill_length_mm)) + \n  geom_boxplot() + \n  theme(axis.title.x = element_blank(),\n        axis.title.y = element_blank())\n```\n\n::: {.cell-output-display}\n![Les dades fan referència als animals preferits dels programadors d'R, els pingüins.](2020213_files/figure-html/unnamed-chunk-3-1.png){width=480}\n:::\n:::\n\n\nPerò la veritat, jo el trobo poc estètic, i m'agrada més la reinterpretació que en fa Edward Tufte. Igual que en el model tradicional, trobem una línia que representa la distància entre el mínim i el primer quartil i el màxim i el tercer quartil respectivament, però la caixa queda substituida per un espai en blanc i la mediana per un punt. Molt més elegant i igual d'informatiu, si m'ho pregunteu.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(penguins, aes(x = species, group = species, y = bill_length_mm)) + \n  geom_tufteboxplot(stat = \"boxplot\") + \n  theme(axis.title.x = element_blank(),\n        axis.title.y = element_blank())\n```\n\n::: {.cell-output-display}\n![](2020213_files/figure-html/unnamed-chunk-4-1.png){width=480}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\np <- temps |> \n  as_tibble() |> \n  mutate(valor_lectura = as.numeric(valor_lectura),\n         data_lectura = lubridate::as_datetime(data_lectura)) |> \n  mutate(mes = lubridate::month(data_lectura, label = TRUE, locale = Sys.getlocale(\"LC_TIME\")),\n         any = (lubridate::year(data_lectura)),\n         mes = str_remove(mes, \"de \"),\n         mes = str_remove(mes, \"d’\"),\n         mes = factor(mes, levels = c(\"gen\", \"febr\", \"març\", \"abr\", \"maig\", \"juny\",\n                                      \"jul\", \"ag\", \"set\", \"oct\", \"nov\", \"des\"))) |> \n  filter(any < 2023) |> \n  ggplot(aes(x = any, y = valor_lectura)) +\n  geom_smooth(method = \"lm\",\n              lwd = 0.5,\n              se = FALSE) + \n  ggthemes::geom_tufteboxplot(aes(group = any), stat = \"boxplot\", outlier.size = 0.25) + \n  stat_summary(fun = mean, fun.args = list(na.rm = TRUE), aes(group = any), \n               geom = \"point\", shape = 4, colour = \"red\") + \n  facet_wrap(~mes,\n             scales = \"free_x\") + \n  ggthemes::theme_tufte(base_family = \"Roboto Condensed\") + \n  theme(axis.title.x = element_blank(),\n        axis.title.y = element_blank())\np\n```\n\n::: {.cell-output-display}\n![Evolució de la temperatura per mesos 2009-2022. El punt negre indica la mediana, la x vermella la mitjana, i la línia blava la tendència entre 2009 i 2022.](2020213_files/figure-html/unnamed-chunk-5-1.png){width=864}\n:::\n:::\n\n\nVeiem que els febrers i els desembres són els mesos que més s'han escalfat entre 2009 i 2022, seguits de prop de maigs, junys, juliols i, un pèl menys, setembres. La primavera i la tardor s'avancen cada cop més, com ja sabem de sobres.",
    "supporting": [
      "2020213_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}