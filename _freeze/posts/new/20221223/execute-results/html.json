{
  "hash": "b871160444de5b35059f1d46aa45442f",
  "result": {
    "markdown": "---\ntitle: \"Lloguers i renda per barris\"\nauthor: \"Marc Bosch Matas\"\ndate: \"2022-12-23\"\ncategories: [OpenStreetMap, OpenData, Dades Obertes, R]\nexecute:\n  warning: false\n  error: false\n  message: false\nformat:\n  html: \n    code-fold: true\n    code-summary: \"Codi R\"\n---\n\n\nFa no massa dies, el diari Nació Digital publicava una [notícia amb les noves dades de lloguers als municipis de Catalunya i els barris de Barcelona](https://www.naciodigital.cat/noticia/250583/lloguer-municipis-barris-barcelona-encarit-euros-any) amb el creixement desmesurat que ha tingut en els darrers mesos. Amb això, m'han agafat ganes de mirar-ho amb una mica més de perspectiva, en concret: **quina evolució han tingut als barris de Barcelona els darrers anys? Quin impacte tenen els lloguers com a percentatge de la renda mitjana del barri?** Vegem-ho amb les dades que publica l'Agència de l'Habitatge de Catalunya.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(readxl)\nlibrary(ggthemes)\nlibrary(patchwork)\npath <- \"/home/marc/Documents/trimestral_bcn_lloguer.xlsx\"\nlloguer_2022 <- read_xlsx(path = path,\n                          sheet = \"2022\",\n                          range = \"B22:E94\",\n                          na = \"nd\",\n                          col_names = c(\"barri\", \"2022/01/01\",\"2022/04/01\",\n                                        \"2022/07/01\"))\nlloguer_2021 <- read_xlsx(path = path,\n                          sheet = \"2021\",\n                          range = \"B22:F94\",\n                          na = c(\"nd\",\"0\"),\n                          col_names = c(\"barri\", \"2021/01/01\",\n                                        \"2021/04/01\", \"2021/07/01\", \n                                        \"2021/10/01\"))\n\nlloguer_2020 <- read_xlsx(path = path,\n                          sheet = \"2020\",\n                          range = \"B22:F94\",\n                          na = c(\"nd\",\"0\"),\n                          col_names = c(\"barri\", \"2020/01/01\",\n                                        \"2020/04/01\", \"2020/07/01\", \n                                        \"2020/10/01\"))\nlloguer_2019 <- read_xlsx(path = path,\n                          sheet = \"2019\",\n                          range = \"B22:F94\",\n                          na = c(\"nd\",\"0\", \"\"),\n                          col_names = c(\"barri\", \"2019/01/01\",\n                                        \"2019/04/01\", \"2019/07/01\", \n                                        \"2019/10/01\"))\nlloguer_2018 <- read_xlsx(path = path,\n                          sheet = \"2018\",\n                          range = \"B22:F94\",\n                          na = c(\"nd\",\"0\", \"\"),\n                          col_names = c(\"barri\", \"2018/01/01\",\n                                        \"2018/04/01\", \"2018/07/01\", \n                                        \"2018/10/01\"))\nlloguer_2017 <- read_xlsx(path = path,\n                          sheet = \"2017\",\n                          range = \"B22:F94\",\n                          na = c(\"nd\",\"0\", \"\"),\n                          col_names = c(\"barri\", \"2017/01/01\",\n                                        \"2017/04/01\", \"2017/07/01\", \n                                        \"2017/10/01\"))\n\nlloguer_2016 <- read_xlsx(path = path,\n                          sheet = \"2016\",\n                          range = \"B22:F94\",\n                          na = c(\"nd\",\"0\", \"\", \"n.d.\"),\n                          col_names = c(\"barri\", \"2016/01/01\",\n                                        \"2016/04/01\", \"2016/07/01\", \n                                        \"2016/10/01\"))\nlloguer_2015 <- read_xlsx(path = path,\n                          sheet = \"2015\",\n                          range = \"B21:F93\",\n                          na = c(\"nd\",\"0\", \"\", \"n.d.\"),\n                          col_names = c(\"barri\", \"2015/01/01\",\n                                        \"2015/04/01\", \"2015/07/01\", \n                                        \"2015/10/01\"))\nlloguer_2014 <- read_xlsx(path = path,\n                          sheet = \"2014\",\n                          range = \"B21:F93\",\n                          na = c(\"nd\",\"0\", \"\", \"n.d.\"),\n                          col_names = c(\"barri\", \"2014/01/01\",\n                                        \"2014/04/01\", \"2014/07/01\", \n                                        \"2014/10/01\"))\n\nrenda_barris <- read_csv(\"https://opendata-ajuntament.barcelona.cat/data/dataset/c9b9b5e5-b02f-4b47-892b-79acf0191802/resource/0d9df8cf-8b95-43c3-b07d-14e11f2ebdaf/download/2019_renda_neta_mitjana_per_llar.csv\")\n```\n:::\n\n\n\n\nPrimer de tot, com s'ha comportat el lloguer mitjà a cada barri des del principi de 2014 fins a finals de setembre de 2022?\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlloguer_total <- lloguer_2014 |>  \n  left_join(lloguer_2015, by = \"barri\") |> \n  left_join(lloguer_2016, by = \"barri\") |> \n  left_join(lloguer_2017, by = \"barri\") |> \n  left_join(lloguer_2018, by = \"barri\") |> \n  left_join(lloguer_2019, by = \"barri\") |> \n  left_join(lloguer_2020, by = \"barri\") |> \n  left_join(lloguer_2021, by = \"barri\") |> \n  left_join(lloguer_2022, by = \"barri\")\nlloguer_total$count_na <- rowSums(is.na(lloguer_total))\n\ndifs <- lloguer_total |>\n  filter(count_na == 0) |> \n  rowwise() |> \n  mutate(dif = `2022/01/01`-`2014/01/01`) |> \n  select(barri, dif)\n# eliminate sections w too many na\n\nlloguer_total_long <- lloguer_total |>  \n  filter(count_na == 0) |> \n  select(-count_na) |> \n  pivot_longer(-barri, names_to = \"trimestre\", values_to = \"lloguer\") |> \n  mutate(trimestre = as.Date(trimestre)) |> \n  left_join(difs, by = \"barri\") |> \n  mutate(barri = factor(barri),\n         barri = fct_reorder(barri,dif))\n\nbegs <- lloguer_total_long |> \n  group_by(barri) |> \n  filter(trimestre == \"2014/01/01\")\n\nends <- lloguer_total_long |> \n  group_by(barri) |> \n  filter(trimestre == \"2022/07/01\")\n\nggplot(lloguer_total_long, aes(x = trimestre, y = lloguer)) + \n  geom_line() + \n  geom_point(data = begs,\n             colour = modthemes::dubois_green) + \n  geom_point(data = ends,\n             colour = modthemes::dubois_red) + \n  geom_text(data = begs, mapping = aes(label = round(lloguer,0)), \n            nudge_x = -300, size = 3.5) + \n  geom_text(data = ends, mapping = aes(label = round(lloguer,0)), \n            nudge_x = 300, size = 3.5) + \n    scale_y_continuous(expand = c(1, 0)) +\n  facet_grid(barri ~ ., scales = \"free_y\") +\n  ggthemes::theme_tufte(base_family = \"Montserrat\") + \n  theme(axis.title=element_blank(), \n        axis.text.y = element_blank(),\n        strip.text.y = element_text(angle = 0), # etiquetes horitzontals\n        text = element_text(family = \"Montserrat\"),\n        axis.ticks.y = element_blank()) \n```\n\n::: {.cell-output-display}\n![Evolució del lloguer per barris 2014-2022. S'han eliminat els barris amb  valors perduts.](20221223_files/figure-html/sparklines lloguer-1.png){width=672}\n:::\n:::\n\n\n\nVeiem que no hi ha cap barri que es salvi de pujades importants, tot i que no tots ho han fet al mateix ritme. Vegem-ho ara en relació de la renda mitjana per llar de cada barri: quin percentatge de la renda mitjana suposa el lloguer mitjà? I quin percentatge suposa l'increment en euros del lloguer entre el tercer trimestre de 2021 i la mateixa data de 2022?\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrenda_barris_group <- renda_barris |> \n  mutate(Nom_Barri = case_when(Nom_Barri == \"el Gòtic\" ~ \"el Barri Gòtic\",\n                               Nom_Barri == \"el Poble Sec\" ~ \"el Poble Sec - AEI Parc Montjuïc\",\n                               Nom_Barri == \"la Marina del Prat Vermell\" ~ \"la Marina del Prat Vermell - AEI Zona Franca\",\n                               Nom_Barri == \"el Putget i Farró\" ~ \"el Putxet i el Farró\",\n                               Nom_Barri == \"Vila de Gràcia\" ~ \"la Vila de Gràcia\",\n                               Nom_Barri == \"Camp de l'Arpa del Clot\" ~ \"el Camp de l'Arpa del Clot\",\n                               TRUE ~ Nom_Barri)) |> \n  group_by(Nom_Barri) |> \n  summarise(renda = mean(Import_Euros, na.rm = TRUE))\nlloguer_2221 <- lloguer_total |> \n  select(barri, \"2022/07/01\", \"2021/07/01\") |> \n  rowwise() |> \n  mutate(dif = `2022/07/01`-`2021/07/01`) |> \n  select(-`2021/07/01`) |> \n  left_join(renda_barris_group, by = c(\"barri\" = \"Nom_Barri\")) |> \n  mutate(\"lloguer\" = `2022/07/01`/renda,\n         \"creixement\" = dif/renda) |> \n  select(barri, lloguer, creixement) |> \n  filter(!is.na(creixement))\n\n\nggplot(lloguer_2221, aes(y = reorder(barri, lloguer), x = lloguer)) + \n  geom_bar(stat = \"identity\",\n           fill = \"white\",\n           colour = \"black\") + \n  geom_text(aes(label = round(lloguer,2)), nudge_y = 0.02) + \n  ggthemes::theme_tufte(base_family = \"Montserrat\") + \n  theme(axis.title = element_blank(),\n        text = element_text(family = \"Montserrat\"))\n```\n\n::: {.cell-output-display}\n![Lloguer mitjà per barri al tercer trimestre de 2022 en relació a la renda mitjana del barri. La renda del barri es calcula com la mitjana entre les rendes de cada secció censal i correspon al darrer valor disponible al portal de dades de l'Ajuntament de Barcelona (2019)](20221223_files/figure-html/rents and income-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(lloguer_2221, aes(y = reorder(barri, creixement), x = creixement)) + \n  geom_bar(stat = \"identity\",\n           fill = \"white\",\n           colour = \"black\") + \n    geom_text(aes(label = round(creixement,4)), nudge_y = 0.002) +\n  ggthemes::theme_tufte(base_family = \"Montserrat\") + \n  theme(axis.title = element_blank())\n```\n\n::: {.cell-output-display}\n![Increment del lloguer mitjà per barri entre el tercer trimestre de 2021 i la mateixa data de 2022 en relació a la renda mitjana del barri. La renda del barri es calcula com la mitjana entre les rendes de cada secció censal i correspon al darrer valor disponible al portal de dades de l'Ajuntament de Barcelona (2019)](20221223_files/figure-html/rent growth by income-1.png){width=672}\n:::\n:::\n\n\nCap sorpresa. El lloguer suposa un percentatge més elevat de la renda per llar a Ciutat Vella (pressió turística), algunes zones del POblenou, Sants-Montjuic, Gràcia i Eixample.\nPel que fa a l'increment del lloguer, no veiem un patró clar, malgrat que els increments han estat menors respecte a la renda per llar en zones de rendes baixes (amb excepcions com Pedralbes) i a les zones on suposen increments més elevats, veiem llocs tant diferents com Sant Martí de Provençals, la Bordeta o Vallvidrera, el Tibidabo i Les Planes.",
    "supporting": [
      "20221223_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}